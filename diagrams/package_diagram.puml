@startuml Package Diagram
!theme plain
skinparam backgroundColor #FFFFFF
skinparam roundcorner 10

title Package Structure Diagram\nmicroROS WASM Project Organization

package "WASM Modules" {
    package "Publisher Module" {
        [PublisherNode] as PUB_NODE
        [Sensor Logic] as SENSOR
        [Message Generator] as MSG_GEN
    }
    
    package "Subscriber Module" {
        [SubscriberNode] as SUB_NODE
        [Actuator Logic] as ACTUATOR
        [Message Processor] as MSG_PROC
    }
}

package "microROS Core (WASM)" {
    package "ROS2 API" {
        [Node API] as NODE_API
        [Publisher API] as PUB_API
        [Subscriber API] as SUB_API
        [Service API] as SVC_API
    }
    
    package "DDS Transport" {
        [DDS Writer] as DDS_WRITE
        [DDS Reader] as DDS_READ
        [DDS Discovery] as DDS_DISC
    }
    
    package "WASI Interface" {
        [Network I/O] as NET_IO
        [Memory Management] as MEM_MGT
        [System Calls] as SYS_CALL
    }
}

package "Kubernetes Layer" {
    package "Orchestration" {
        [Deployment] as DEPLOY
        [Service] as SVC
        [ConfigMap] as CONFIG
        [Secret] as SECRET
    }
    
    package "Runtime" {
        [Wasmtime Runtime] as WASMTIME
        [Wasmer Runtime] as WASMER
        [Container Runtime] as CONTAINER
    }
}

package "ROS2 Network" {
    [DDS Network] as DDS_NET
    [Topics] as TOPICS
    [Services] as SERVICES
    [Discovery] as DISC
}

PUB_NODE --> NODE_API : uses
SUB_NODE --> NODE_API : uses
PUB_NODE --> PUB_API : uses
SUB_NODE --> SUB_API : uses

PUB_API --> DDS_WRITE : uses
SUB_API --> DDS_READ : uses
DDS_WRITE --> NET_IO : uses
DDS_READ --> NET_IO : uses
DDS_DISC --> NET_IO : uses

NET_IO --> WASI : implements
MEM_MGT --> WASI : implements
SYS_CALL --> WASI : implements

WASMTIME --> PUB_NODE : executes
WASMTIME --> SUB_NODE : executes
WASMER --> PUB_NODE : executes
WASMER --> SUB_NODE : executes

DEPLOY --> WASMTIME : manages
DEPLOY --> WASMER : manages
SVC --> WASMTIME : exposes
SVC --> WASMER : exposes

DDS_WRITE --> DDS_NET : communicates
DDS_READ --> DDS_NET : communicates
DDS_DISC --> DISC : participates

note right of "microROS Core (WASM)"
  **All ROS functionality**
  **compiled to WASM:**
  
  • No external dependencies
  • Self-contained
  • Portable
end note

note right of "Kubernetes Layer"
  **Orchestration provides:**
  
  • Deployment management
  • Service discovery
  • Resource allocation
  • Health monitoring
end note

@enduml

