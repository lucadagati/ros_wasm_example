@startuml Communication Sequence
!theme plain
skinparam backgroundColor #FFFFFF
skinparam sequenceArrowThickness 2
skinparam roundcorner 20
skinparam maxmessagesize 60
skinparam ParticipantPadding 20

title Communication Sequence Diagram\nmicroROS in WASM Runtime

participant "Publisher WASM\n(microROS)" as P #667eea
participant "ROS2 DDS\n(inside WASM)" as DDS #FFC107
participant "ROS2 Topic\nNetwork" as TOPIC #9C27B0
participant "ROS2 DDS\n(inside WASM)" as DDS2 #FFC107
participant "Subscriber WASM\n(microROS)" as S #f5576c

== Initialization ==
P -> P: Initialize microROS
activate P
P -> DDS: Setup DDS transport
activate DDS
DDS -> TOPIC: Register publisher
activate TOPIC
deactivate TOPIC
deactivate DDS

S -> S: Initialize microROS
activate S
S -> DDS2: Setup DDS transport
activate DDS2
DDS2 -> TOPIC: Register subscriber
activate TOPIC
deactivate TOPIC
deactivate DDS2

== Message Publishing Loop ==
loop Every second
    P -> P: generateMessage()\n(in WASM)
    P -> DDS: publish(topic, message)
    activate DDS
    DDS -> TOPIC: ROS2 DDS publish
    activate TOPIC
    TOPIC -> DDS2: message delivery
    deactivate TOPIC
    activate DDS2
    DDS2 -> S: processMessage(data)\n(in WASM)
    deactivate DDS2
    S -> S: update statistics\n(in WASM)
    deactivate DDS
end

note over P, S
  **All ROS operations**
  **execute inside WASM**
  
  Latency: ~5-30ms
  Throughput: configurable
end note

@enduml
